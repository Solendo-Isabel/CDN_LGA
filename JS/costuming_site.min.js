let Iframe_id = "Comunica"

const Close_image = "https://okulisenga.netlify.app/assets/comunica_close.svg"
const Open_image = "https://okulisenga.netlify.app/assets/comunica_open.svg"

const IFRAME = document.createElement("iframe")
IFRAME.setAttribute("frameborder",0)
IFRAME.id = Iframe_id

const floatingButton = document.createElement("button")
floatingButton.classList.add("UnClickable")
floatingButton.id = "floatingButton"

const IMAGE = document.createElement("img")
IMAGE.setAttribute("src",Open_image)
IMAGE.classList.add("Unclickable")
IMAGE.id = "floatingButtonImage"
floatingButton.appendChild(IMAGE)

document.body.appendChild(floatingButton)
document.body.appendChild(IFRAME)


const setClickable = (Pointer) => {
    if(document.querySelector(`#${Iframe_id}`).style.display === "block"){ 
        if(Pointer.target.id != "floatingButtonImage" &&  Pointer.target.id != "floatingButton"){
            Pointer.target.classList.add("Clickable")
            console.log("Added")
        }
    }

}
const removeClicable = (Pointer) => {
    if(document.querySelector(`#${Iframe_id}`).style.display === "block"){
        Pointer.target.classList.remove("Clickable")
    }
}
const sendInput = (Pointer) => {
    if(document.querySelector(`#${Iframe_id}`).style.display === "block"){
        if(Pointer.target.classList.contains("Clickable") &&  (Pointer.target.id != "floatingButtonImage" &&  Pointer.target.id != "floatingButton")){
            document.querySelector(`#${Iframe_id}`).contentWindow.postMessage(Pointer.target.textContent,"http://127.0.0.1:7000")
            console.log(Pointer.target.textContent)
        }
    }

}

const showPlayer = () => {
    if (document.querySelector(`#${Iframe_id}`).style.display === 'none' || document.querySelector(`#${Iframe_id}`).style.display === '') {
        console.log(`#${Iframe_id}`)
        document.querySelector(`#${Iframe_id}`).setAttribute("src",'http://127.0.0.1:7000/player/app')
        document.querySelector(`#${Iframe_id}`).style.display = 'block';
        IMAGE.setAttribute("src",Close_image)

    }else{
        document.querySelector(`#${Iframe_id}`).style.display = 'none';
        IMAGE.setAttribute("src",Open_image)

    }
}
document.querySelector(`#${Iframe_id}`).onload = () => {
    document.body.addEventListener("mouseover",setClickable)
    document.body.addEventListener("mouseout",removeClicable)
    document.body.addEventListener("click",sendInput)
}

IMAGE.addEventListener("click",showPlayer)

