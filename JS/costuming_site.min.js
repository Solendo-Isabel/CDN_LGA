let Iframe_id = "Comunica"

const Close_image = "https://lokiamero.netlify.app/assets/comunica_close.svg"
const Open_image = "https://lokiamero.netlify.app/assets/comunica_open.svg"

const IFRAME = document.createElement("iframe")
IFRAME.setAttribute("frameborder",0)
IFRAME.id = Iframe_id

const floatingButton = document.createElement("button")
floatingButton.classList.add("UnClickable")

const IMAGE = document.createElement("img")
IMAGE.setAttribute("src",Open_image)
IMAGE.classList.add("Unclickable")
IMAGE.id = "floatingButton"
floatingButton.appendChild(IMAGE)

document.body.appendChild(floatingButton)
document.body.appendChild(IFRAME)

const showPlayer = () => {
    if (document.querySelector(`#${Iframe_id}`).style.display === 'none' || document.querySelector(`#${Iframe_id}`).style.display === '') {
        console.log(`#${Iframe_id}`)
        document.querySelector(`#${Iframe_id}`).setAttribute("src",'http://127.0.0.1:8000/player/app')
        document.querySelector(`#${Iframe_id}`).style.display = 'block';
        IMAGE.setAttribute("src",Close_image)
        IMAGE.style.width = "30px"
        IMAGE.style.height = "30px"
    }else{
        document.querySelector(`#${Iframe_id}`).style.display = 'none';
        IMAGE.setAttribute("src",Open_image)
        IMAGE.style.width = "60px"
        IMAGE.style.height = "60px"

    }
}

const setClickable = (Pointer) => {
    if(Pointer.target.id != "floatingButton"){
        Pointer.target.classList.add("Clickable")
        console.log("Added")
    }

}
const getInput = (Pointer) => {
    Pointer.target.classList.remove("Clickable")
}
const sendInput = (Pointer) => {
    if(Pointer.target.classList.contains("Clickable") &&  Pointer.target.id != "floatingButton"){
        document.querySelector(`#${Iframe_id}`).contentWindow.postMessage(Pointer.target.textContent,"http://127.0.0.1:8000")
        console.log(Pointer.target.textContent)
    }

}

IMAGE.addEventListener("click",showPlayer)

document.querySelector(`#${Iframe_id}`).onload = () => {
    document.body.addEventListener("mouseover",setClickable)
    document.body.addEventListener("mouseout",getInput)
    document.body.addEventListener("click",sendInput)
}