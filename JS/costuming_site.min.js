const PAGEBODY = document.body
const IFRAME = document.querySelector("#Comunica")

const Close_image = "https://lokiamero.netlify.app/assets/comunica_close.svg"
const Open_image = "https://lokiamero.netlify.app/assets/comunica_open.svg"

const floatingButton = document.createElement("button")
floatingButton.classList.add("UnClickable")

const IMAGE = document.createElement("img")
IMAGE.setAttribute("src","../assets/Comunica_Open.svg")
IMAGE.classList.add("Unclickable")
IMAGE.id = "floatingButton"
floatingButton.appendChild(IMAGE)

PAGEBODY.appendChild(floatingButton)

const showPlayer = () =>{
    console.log("FFFF")
    if (IFRAME.style.display === 'none' || IFRAME.style.display === '') {
        IFRAME.setAttribute("src",'http://127.0.0.1:8000/player/app')
        IFRAME.style.display = 'block';
        IMAGE.setAttribute("src",Close_image)
        IMAGE.style.width = "30px"
        IMAGE.style.height = "30px"
    }else{
        IFRAME.style.display = 'none';
        IMAGE.setAttribute("src",Open_image)
        IMAGE.style.width = "60px"
        IMAGE.style.height = "60px"

    }
}

const setClickable = (Pointer) => {
    if(Pointer.target.id != "floatingButton"){
        Pointer.target.classList.add("Clickable")
        console.log("Added")
    }

}
const getInput = (Pointer) => {
    Pointer.target.classList.remove("Clickable")
}
const sendInput = (Pointer) => {
    if(Pointer.target.classList.contains("Clickable") &&  Pointer.target.id != "floatingButton"){
        IFRAME.contentWindow.postMessage(Pointer.target.textContent,"http://127.0.0.1:8000")
        console.log(Pointer.target.textContent)
    }

}

IMAGE.addEventListener("click",showPlayer)

IFRAME.onload = () => {
    PAGEBODY.addEventListener("mouseover",setClickable)
    PAGEBODY.addEventListener("mouseout",getInput)
    PAGEBODY.addEventListener("click",sendInput)
}